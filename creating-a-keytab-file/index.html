<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Creating a Kerberos Keytab file with ktutil | Owen Rumney</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Creating a Kerberos Keytab file with ktutil" />
<meta name="author" content="Owen Rumney" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Steps that are required to create a Kerberos keytab file on Linux" />
<meta property="og:description" content="Steps that are required to create a Kerberos keytab file on Linux" />
<link rel="canonical" href="https://www.owenrumney.co.uk/creating-a-keytab-file/" />
<meta property="og:url" content="https://www.owenrumney.co.uk/creating-a-keytab-file/" />
<meta property="og:site_name" content="Owen Rumney" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-23T00:00:00+00:00" />
<script type="application/ld+json">
{"dateModified":"2019-01-23T00:00:00+00:00","datePublished":"2019-01-23T00:00:00+00:00","author":{"@type":"Person","name":"Owen Rumney"},"description":"Steps that are required to create a Kerberos keytab file on Linux","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.owenrumney.co.uk/creating-a-keytab-file/"},"url":"https://www.owenrumney.co.uk/creating-a-keytab-file/","@type":"BlogPosting","headline":"Creating a Kerberos Keytab file with ktutil","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<meta name="keywords" content="linux" />

<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" href="/favicon.ico"/>
<link rel="stylesheet" type="text/css" href="/assets/css/styles.css" />
<link rel="stylesheet" type="text/css" href="/assets/css/prism.css" />
<script src="/assets/js/prism.js"></script>



</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TLCVNKXMFJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TLCVNKXMFJ');
</script>

<body>
    <div class="wrapper">
        <header class="wrapper-header">
            <div class="header">
  <nav class="float-right">
  
  <a href="https://github.com/owenrumney" target="_blank"
    ><img
      src="/assets/images/github.svg"
      style="color: white; display: inline-block"
      height="30px"
      alt="GitHub"
  /></a>
  
  <a href="https://linkedin.com/in/owenrumney" target="_blank"
    ><img
      src="/assets/images/linkedin.svg"
      style="color: white; display: inline-block"
      height="30px"
      alt="LinkedIn"
  /></a>
  
  <a href="https://cv.owenrumney.co.uk" target="_blank"
    ><img
      src="/assets/images/resume.svg"
      style="color: white; display: inline-block"
      height="32px"
      alt="Resume"
  /></a>
  
</nav>

  <a href="https://www.owenrumney.co.uk" target="_blank"><h1>Owen Rumney</h1></a>
  <br />
  <h5><i>Software Engineer</i></h5>
  <br />

  <hr />
</div>

        </header>

        <main class="wrapper-main">
            <div class="main-content">
            <div class="post-info">
    <h2>Creating a Kerberos Keytab file with ktutil</h2>
    <p>23 Jan 2019 - Owen Rumney</p>
</div>

<div class="post-content">
<h2 id="assumptions">Assumptions</h2>

<p>I’m assuming for anyone who is doing this that you have your <code class="language-plaintext highlighter-rouge">/etc/krb5.conf</code> in order and that isn’t going to get in your way.</p>

<p>One thing you’re going to want to know is what your permitted and default <code class="language-plaintext highlighter-rouge">enctypes</code> and the realm are from this file. In my case I’m going to use <code class="language-plaintext highlighter-rouge">aes128-cts-hmac-sha1-96</code> and my realm is <code class="language-plaintext highlighter-rouge">DPE.INTERNAL</code>.</p>

<h2 id="creating-the-keytab-file">Creating the keytab file</h2>

<p>To create the keytab file you’re going to need <code class="language-plaintext highlighter-rouge">ktutil</code> (and a number of other <code class="language-plaintext highlighter-rouge">kxxxxxx</code> commands)</p>

<p><strong>RHEL/Centos</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum install krb5-workstation
</code></pre></div></div>

<p><strong>Ubuntu</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install krb5-user
</code></pre></div></div>

<p>Now you have the required programs installed, you can create your keytab file using <code class="language-plaintext highlighter-rouge">ktutil</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ktutil
</code></pre></div></div>

<p>This will present you with a prompt for you to add the entries in the keytab file</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>add_entry <span class="nt">-password</span> <span class="nt">-p</span> user@DPE.INTERNAL <span class="nt">-k</span> 1 <span class="nt">-e</span> aes256-cts-hmac-sha1-96
Password <span class="k">for </span>user@DPE.INTERNAL: &lt;enter password here&gt;

write_kt user.keytab
quit
</code></pre></div></div>

<p>Breaking this down, we are saying that we want to add an entry to the keytab using a password for authentication.</p>

<p>The <code class="language-plaintext highlighter-rouge">-p</code> is the principal that we will be logging in as using the end file.</p>

<p>The <code class="language-plaintext highlighter-rouge">-k</code> refers to the Key Version Number which in some situations isn’t really needed and is ignored (in Windows environment for example). You can get the current Key version number (kvno) by using the <code class="language-plaintext highlighter-rouge">kvno</code> command</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kvno user@DPE.INTERNAL
user@DPE.INTERNAL: kvno <span class="o">=</span> 1
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">-e</code> refers to the enctype mentioned earlier. This needs to be one of those that are permitted in your <code class="language-plaintext highlighter-rouge">krb5.conf</code> file so you’re using an accepted and appropriate encryption.</p>

<h2 id="testing-the-key">Testing the Key</h2>

<p>We can now test the keytab for successfully login</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kinit <span class="nt">-kt</span> user.keytab user@DPE.INTERNAL
</code></pre></div></div>

<p>This should exit normally, then we can check we’ve got a ticket using <code class="language-plaintext highlighter-rouge">klist</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>klist

Ticket cache: FILE:/tmp/krb5cc_1000
Default principal: user@DPE.INTERNAL

Valid Starting           Expires                Service principal
01/23/2019 14:27:28      01/24/2019 00:27:28    user@DPE.INTERNAL
</code></pre></div></div>

<p>To clear out the ticket, you can use <code class="language-plaintext highlighter-rouge">kdestroy</code>. This will remove all current authentications.</p>

</div>

            </div>
        </main>
    </div>

    <footer class="wrapper-footer">
        <div class="footer">
    <span class="footer-text float-left">This work is licensed under <a rel="license" href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank">GPLv3</a></span>
    <span class="footer-text float-right">
    Site Updated: 2023-12-01  (<a href="/feed.xml" target="_blank">RSS</a>)
  </span>
</div>
    </footer>
</body>
</html>
