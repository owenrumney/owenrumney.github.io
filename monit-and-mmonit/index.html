<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Monit | Owen Rumney</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Monit" />
<meta name="author" content="Owen Rumney" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="There are lots of monitoring and alerting tools out there and I’m sure everyone has there own preference on which they’re going to use." />
<meta property="og:description" content="There are lots of monitoring and alerting tools out there and I’m sure everyone has there own preference on which they’re going to use." />
<link rel="canonical" href="https://www.owenrumney.co.uk/monit-and-mmonit/" />
<meta property="og:url" content="https://www.owenrumney.co.uk/monit-and-mmonit/" />
<meta property="og:site_name" content="Owen Rumney" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-03-17T00:00:00+00:00" />
<script type="application/ld+json">
{"dateModified":"2017-03-17T00:00:00+00:00","datePublished":"2017-03-17T00:00:00+00:00","author":{"@type":"Person","name":"Owen Rumney"},"description":"There are lots of monitoring and alerting tools out there and I’m sure everyone has there own preference on which they’re going to use.","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.owenrumney.co.uk/monit-and-mmonit/"},"url":"https://www.owenrumney.co.uk/monit-and-mmonit/","@type":"BlogPosting","headline":"Monit","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<meta name="keywords" content="monitoring,linux" />

<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" href="/favicon.ico"/>
<link rel="stylesheet" type="text/css" href="/assets/css/styles.css" />
<link rel="stylesheet" type="text/css" href="/assets/css/prism.css" />
<script src="/assets/js/prism.js"></script>



</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TLCVNKXMFJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TLCVNKXMFJ');
</script>

<body>
    <div class="wrapper">
        <header class="wrapper-header">
            <div class="header">
  <nav class="float-right">
  
  <a href="https://github.com/owenrumney" target="_blank"
    ><img
      src="/assets/images/github.svg"
      style="color: white; display: inline-block"
      height="30px"
      alt="GitHub"
  /></a>
  
  <a href="https://linkedin.com/in/owenrumney" target="_blank"
    ><img
      src="/assets/images/linkedin.svg"
      style="color: white; display: inline-block"
      height="30px"
      alt="LinkedIn"
  /></a>
  
  <a href="https://cv.owenrumney.co.uk" target="_blank"
    ><img
      src="/assets/images/resume.svg"
      style="color: white; display: inline-block"
      height="32px"
      alt="Resume"
  /></a>
  
</nav>

  <a href="https://www.owenrumney.co.uk" target="_blank"><h1>Owen Rumney</h1></a>
  <br />
  <h5><i>Software Engineer</i></h5>
  <br />

  <hr />
</div>

        </header>

        <main class="wrapper-main">
            <div class="main-content">
            <div class="post-info">
    <h2>Monit</h2>
    <p>17 Mar 2017 - Owen Rumney</p>
</div>

<div class="post-content">
<p>There are lots of monitoring and alerting tools out there and I’m sure everyone has there own preference on which they’re going to use.</p>

<p>We have selected <a href="http://mmonit.com/monit/">monit</a> for simple monitoring of disk space, tunnels and processes because its simple to setup and does exactly what we’re asking it to do.</p>

<p>I particularly like DSL for defining which checks you want to perform.</p>

<p>As we’re running monit on multiple machines, we’re also evaluating <a href="http//mmonit.com">m/monit</a> which centralises the monitoring of all the separate instances in a nice dashboard.</p>

<h2 id="installing-monit">Installing Monit</h2>

<p>Our servers are Red Hat so we’re not using <code class="language-plaintext highlighter-rouge">yum install monit</code> which will get you stated on on a Fedora machine. Equally the downloads page on the monit site will give you the quick and easy installation for other common platforms.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># create the install folder
sudo mkdir /opt/monit
cd /opt/monit

# get the latest release
wget http://mmonit.com/monit/dist/binary/5.21.0/monit-5.21.0-linux-x64.tar.gz

# unpack
tar -xvf monit-5.21.0-linux-x64.tar.gz
rm monit-5.21.0-linux-x64.tar.gz
mv monit-5.21.0 5.21.0
cd 5.21.0

# put some links in
sudo ln -s /opt/monit/5.21.0/conf/monitrc /etc/monitrc
sudo ln -s /opt/monit/5.21.0/bin/monit /usr/bin/monit
</code></pre></div></div>

<h3 id="configuring-monit">Configuring Monit</h3>

<p>Now the links are in we can configure the monit config file <code class="language-plaintext highlighter-rouge">monitrc</code>. The actually file has huge amounts of documentation; I’m going to limit this to the key points to get up and running</p>

<p><code class="language-plaintext highlighter-rouge">sudo vi /etc/monitrc</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>######################
## Monit control file
######################

set daemon  30   # check services at 30 seconds intervals

set logfile syslog

# configure the mmonit to report to
# set mmonit https://monit:monit@10.10.1.10:8443/collector

# configure email alerts (this is using AWS SES)
SET ALERT alerts@mycompany.com
SET MAILSERVER email-smtp.eu-west-1.amazonaws.com port 587
        username "" password ""
        using TLSV1
        with timeout 30 seconds

set mail-format {
from: my_ses_registered_email@mycompany.com
reply-to: my_ses_registered_email@mycompany.com
subject: $EVENT
message:
Monit
=====
Date:    $DATE
Host:    $HOST
Action:  $ACTION
Service: $SERVICE
Event:   $EVENT

Description:
============
$DESCRIPTION.
}

# configure the host connection
set httpd port 2812 and
  use address 0.0.0.0
  allow 0.0.0.0
  allow admin:monit # change the password


# configure checks - for example processes
CHECK PROCESS tunnel_somewhere MATCHING '.*?(autossh.*?(8081))'

# or disk space
CHECK DEVICE root WITH PATH /
  IF SPACE usage &gt; 80% THEN ALERT

# or network connections
check network eth0 with interface eth0
  IF upload &gt; 1 MB/s THEN ALERT
  IF total downloaded &gt; 1 GB in last 2 hours THEN ALERT
  IF total downloaded &gt; 10 GB in last day THEN ALERT
</code></pre></div></div>

<h3 id="starting-monit">Starting Monit</h3>

<p>To start monit user</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo monit start
</code></pre></div></div>

<p>If you make changes to <code class="language-plaintext highlighter-rouge">/etc/monitrc</code> then you can reload it with <code class="language-plaintext highlighter-rouge">sudo monit reload</code></p>

</div>

            </div>
        </main>
    </div>

    <footer class="wrapper-footer">
        <div class="footer">
    <span class="footer-text float-left">This work is licensed under <a rel="license" href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank">GPLv3</a></span>
    <span class="footer-text float-right">
    Site Updated: 2023-12-01  (<a href="/feed.xml" target="_blank">RSS</a>)
  </span>
</div>
    </footer>
</body>
</html>
